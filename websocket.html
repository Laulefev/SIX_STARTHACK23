<html lang="en">
<head>
    <title>SIX Market Data Stream - WebSocket</title>
</head>
<body style="margin: 35px">

<h1>SIX Market Data Streaming - WebSocket</h1>

<form>
    <label for="inputElement"></label>
    <textarea id="inputElement" placeholder="type your query..." style="width:1400px;font-size: medium" rows="16">
query HelloWorld {
  snapshot(scheme: TICKER_BC, ids: ["ABBN_4"]) {
    type
    requestedId
    requestedScheme
    orderBook { position side size price }
  }
}
    </textarea>
    <br/>
    <input onclick="sendMsg();" value="send" type="button">
</form>

<div id="outputElement" style="width:1400px; height: 300px; background: #eee; overflow:scroll; margin-top: 10px"></div>

<script>
    const uri = "wss://web.api.six-group.com/api/findata/v1/websocket";
    const webSocket = new WebSocket(uri);
    const inputElement = document.getElementById("inputElement");
    const outputElement = document.getElementById("outputElement");

    webSocket.onmessage = function (event) {
        const json = event.data;
        outputElement.innerHTML += "<br> Server>: " + "<b>" + json + "</b>";
        outputElement.scrollTop = outputElement.scrollHeight;
    };

    webSocket.onopen = function () {
        console.log("connection opened");
    };

    webSocket.onclose = function (event) {
        console.log("connection closed: " + JSON.stringify(event));
    };

    webSocket.onerror = function (event) {
        console.log("error: " + JSON.stringify(event));
    };

    window.onclose = function () {
        console.log("connection closed");
        webSocket.close();
    }

    inputElement.addEventListener("keyup", function (event) {
        event.preventDefault();
        if (event.key === "Enter") {
            sendMsg();
        }
    });

    function sendMsg() {
        const json = JSON.stringify({query: inputElement.value});
        webSocket.send(json);
        outputElement.innerHTML += "<div style='color:green'>Client> " + json + "</div>";
        inputElement.value = "";
    }
</script>
</body>
</html>